<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Panel Docente - BlackQuery</title>
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/dark-mode-base.css" />
    <link rel="stylesheet" href="css/dark-mode-principal.css" />
    <style>
      /* Global Styles with Dark Mode Support */
      body {
        background: var(--bg-color, #f4f6f9);
        color: var(--text-color, #2c3e50);
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        transition: background-color 0.3s ease, color 0.3s ease;
        margin: 0;
        padding: 0;
      }

      body.dark-mode {
        background: var(--bg-color-dark, #1a1a2e);
        color: var(--text-color-dark, #e2e8f0);
      }

      body.dark-mode h1,
      body.dark-mode h2,
      body.dark-mode h3,
      body.dark-mode h4 {
        color: var(--text-color-dark, #e2e8f0);
      }

      .teacher-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
        min-height: 100vh;
      }

      .teacher-section {
        background: var(--card-bg, white);
        border-radius: 10px;
        padding: 25px;
        margin: 20px 0;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
      }

      body.dark-mode .teacher-section {
        background: var(--card-bg-dark, #2c3e50);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }

      .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin: 20px 0;
      }

      .dashboard-card {
        background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        color: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        transition: all 0.3s ease;
        box-shadow: 0 4px 6px rgba(79, 70, 229, 0.2);
      }

      body.dark-mode .dashboard-card {
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        box-shadow: 0 4px 6px rgba(99, 102, 241, 0.3);
      }

      .dashboard-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 12px rgba(79, 70, 229, 0.3);
      }

      body.dark-mode .dashboard-card:hover {
        box-shadow: 0 8px 12px rgba(99, 102, 241, 0.4);
      }

      .dashboard-card h3 {
        margin: 0 0 10px 0;
        font-size: 1.2em;
      }

      .dashboard-card .number {
        font-size: 2.5em;
        font-weight: bold;
        margin: 10px 0;
      }

      .tabs {
        display: flex;
        background: var(--tab-bg, #f8f9fa);
        border-radius: 8px;
        margin: 20px 0;
        overflow: hidden;
        flex-wrap: wrap;
      }

      body.dark-mode .tabs {
        background: var(--tab-bg-dark, #34495e);
      }

      .tab {
        flex: 1;
        min-width: 150px;
        padding: 15px 20px;
        background: var(--tab-inactive, #e9ecef);
        border: none;
        cursor: pointer;
        transition: all 0.3s;
        font-weight: bold;
        color: var(--text-color, #333);
      }

      body.dark-mode .tab {
        background: var(--tab-inactive-dark, #2c3e50);
        color: var(--text-color-dark, #ecf0f1);
      }

      .tab.active {
        background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        color: white;
        box-shadow: 0 2px 4px rgba(79, 70, 229, 0.3);
      }

      body.dark-mode .tab.active {
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        box-shadow: 0 2px 4px rgba(99, 102, 241, 0.4);
      }

      .tab:hover:not(.active) {
        background: #dee2e6;
        transform: translateY(-1px);
      }

      body.dark-mode .tab:hover:not(.active) {
        background: #34495e;
        transform: translateY(-1px);
      }

      .tab-content {
        display: none;
        animation: fadeIn 0.3s;
      }

      .tab-content.active {
        display: block;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .data-table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
      }

      .data-table th,
      .data-table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid var(--border-color, #ddd);
        color: var(--text-color, #333);
      }

      body.dark-mode .data-table th,
      body.dark-mode .data-table td {
        border-bottom-color: var(--border-color-dark, #34495e);
        color: var(--text-color-dark, #ecf0f1);
      }

      .data-table th {
        background: var(--table-header-bg, #f8f9fa);
        font-weight: bold;
      }

      body.dark-mode .data-table th {
        background: var(--table-header-bg-dark, #34495e);
      }

      .data-table tr:hover {
        background: var(--table-hover, #f5f5f5);
      }

      body.dark-mode .data-table tr:hover {
        background: var(--table-hover-dark, #34495e);
      }

      .btn-teacher {
        background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        margin: 2px;
        font-size: 13px;
        font-weight: 500;
        transition: all 0.3s;
        box-shadow: 0 2px 4px rgba(79, 70, 229, 0.2);
      }

      body.dark-mode .btn-teacher {
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        box-shadow: 0 2px 4px rgba(99, 102, 241, 0.3);
      }

      .btn-teacher:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(79, 70, 229, 0.3);
      }

      body.dark-mode .btn-teacher:hover {
        box-shadow: 0 4px 8px rgba(99, 102, 241, 0.4);
      }

      .btn-teacher.danger {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        box-shadow: 0 2px 4px rgba(239, 68, 68, 0.2);
      }

      body.dark-mode .btn-teacher.danger {
        background: linear-gradient(135deg, #f87171 0%, #ef4444 100%);
        box-shadow: 0 2px 4px rgba(248, 113, 113, 0.3);
      }

      .btn-teacher.danger:hover {
        box-shadow: 0 4px 8px rgba(239, 68, 68, 0.3);
      }

      body.dark-mode .btn-teacher.danger:hover {
        box-shadow: 0 4px 8px rgba(248, 113, 113, 0.4);
      }

      .btn-teacher.warning {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        color: white;
        box-shadow: 0 2px 4px rgba(245, 158, 11, 0.2);
      }

      body.dark-mode .btn-teacher.warning {
        background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        box-shadow: 0 2px 4px rgba(251, 191, 36, 0.3);
      }

      .btn-teacher.warning:hover {
        box-shadow: 0 4px 8px rgba(245, 158, 11, 0.3);
      }

      body.dark-mode .btn-teacher.warning:hover {
        box-shadow: 0 4px 8px rgba(251, 191, 36, 0.4);
      }

      .status-badge {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: bold;
        text-transform: uppercase;
      }

      .status-active {
        background: #d4edda;
        color: #155724;
      }

      body.dark-mode .status-active {
        background: #1e4620;
        color: #9ae6b4;
      }

      .status-pending {
        background: #fff3cd;
        color: #856404;
      }

      body.dark-mode .status-pending {
        background: #5a4a1a;
        color: #fbd38d;
      }

      .status-expired {
        background: #f8d7da;
        color: #721c24;
      }

      body.dark-mode .status-expired {
        background: #5a1a1a;
        color: #fc8181;
      }

      .status-processing {
        background: #d1ecf1;
        color: #0c5460;
      }

      body.dark-mode .status-processing {
        background: #1a3a52;
        color: #63b3ed;
      }

      .form-group {
        margin: 10px 0;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: var(--text-color, #333);
      }

      body.dark-mode .form-group label {
        color: var(--text-color-dark, #ecf0f1);
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 8px;
        border: 1px solid var(--border-color, #ddd);
        border-radius: 4px;
        font-size: 14px;
        background: var(--input-bg, white);
        color: var(--text-color, #333);
      }

      body.dark-mode .form-group input,
      body.dark-mode .form-group select,
      body.dark-mode .form-group textarea {
        background: var(--input-bg-dark, #34495e);
        border-color: var(--border-color-dark, #2c3e50);
        color: var(--text-color-dark, #ecf0f1);
      }

      .teacher-welcome {
        background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        color: white;
        padding: 30px;
        border-radius: 12px;
        margin: 20px 0;
        text-align: center;
        box-shadow: 0 4px 6px rgba(79, 70, 229, 0.2);
      }

      body.dark-mode .teacher-welcome {
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        box-shadow: 0 4px 6px rgba(99, 102, 241, 0.3);
      }

      .teacher-welcome h2 {
        margin: 0 0 10px 0;
        font-size: 1.8em;
        font-weight: 600;
      }

      .teacher-welcome p {
        margin: 0;
        font-size: 1.1em;
        opacity: 0.95;
      }

      /* Modal Styles with Dark Mode Support */
      .modal-overlay {
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
      }

      .modal-content,
      div[id$="-modal"] > div {
        background: var(--card-bg, white) !important;
        color: var(--text-color, #2c3e50) !important;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
      }

      body.dark-mode .modal-content,
      body.dark-mode div[id$="-modal"] > div {
        background: var(--card-bg-dark, #2d3748) !important;
        color: var(--text-color-dark, #e2e8f0) !important;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.7);
      }

      body.dark-mode div[id$="-modal"] h4 {
        color: var(--text-color-dark, #e2e8f0) !important;
      }

      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        border-color: #4f46e5;
        outline: none;
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.15);
      }

      body.dark-mode .form-group input:focus,
      body.dark-mode .form-group select:focus,
      body.dark-mode .form-group textarea:focus {
        border-color: #6366f1;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
      }

      body.dark-mode .form-group input[readonly] {
        background: #1a202c;
        color: #a0aec0;
        cursor: not-allowed;
      }

      .alert {
        padding: 12px;
        border-radius: 6px;
        margin: 10px 0;
        font-weight: 500;
      }

      .alert-success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      body.dark-mode .alert-success {
        background: #1e4620;
        color: #9ae6b4;
        border: 1px solid #2f855a;
      }

      .alert-error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      body.dark-mode .alert-error {
        background: #5a1a1a;
        color: #fc8181;
        border: 1px solid #9b2c2c;
      }

      .alert-info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }

      body.dark-mode .alert-info {
        background: #1a3a52;
        color: #63b3ed;
        border: 1px solid #2c5282;
      }
    </style>
  </head>
  <body>
    <nav class="navbar">
      <span class="navbar-title">BlackQuery Docente</span>
      <div class="navbar-actions">
        <button onclick="window.location.href='docente.html'" class="btn panel">
          ğŸ  Inicio
        </button>
        <button onclick="window.location.href='privacy.html'" class="btn panel">
          ğŸ”’ Privacidad
        </button>
        <button onclick="logout()" class="btn logout">Cerrar SesiÃ³n</button>
      </div>
    </nav>

    <div class="teacher-container" id="teacher-container">
      <!-- Bienvenida -->
      <div class="teacher-welcome">
        <h2>ğŸ‘¨â€ğŸ« Panel de GestiÃ³n Docente</h2>
        <p>Gestiona estudiantes y visualiza reportes de todos los proyectos</p>
      </div>

      <!-- PestaÃ±as de gestiÃ³n -->
      <div class="teacher-section">
        <div class="tabs">
          <button
            class="tab active"
            onclick="showTeacherTab('student-management')"
          >
            ğŸ‘¨â€ğŸ“ GestiÃ³n de Estudiantes
          </button>
          <button class="tab" onclick="showTeacherTab('project-monitoring')">
            ğŸ“Š Monitoreo de Proyectos
          </button>
          <button class="tab" onclick="showTeacherTab('reports-analysis')">
            ğŸ“ˆ AnÃ¡lisis de Reportes
          </button>
        </div>

        <!-- Contenido de GestiÃ³n de Estudiantes -->
        <div id="student-management" class="tab-content active">
          <h3>ğŸ‘¨â€ğŸ“ GestiÃ³n de Estudiantes</h3>

          <div class="dashboard-grid">
            <div class="dashboard-card">
              <h3>ğŸ‘¨â€ğŸ“ Total Estudiantes</h3>
              <div class="number" id="total-students">-</div>
              <p>Estudiantes registrados</p>
            </div>
            <div class="dashboard-card">
              <h3>âœ… Estudiantes Activos</h3>
              <div class="number" id="active-students">-</div>
              <p>Estudiantes activos</p>
            </div>
            <div class="dashboard-card">
              <h3>ğŸ“‚ Proyectos Subidos</h3>
              <div class="number" id="total-projects">-</div>
              <p>Proyectos en total</p>
            </div>
            <div class="dashboard-card">
              <h3>ğŸ” AnÃ¡lisis Realizados</h3>
              <div class="number" id="total-analysis">-</div>
              <p>AnÃ¡lisis completados</p>
            </div>
          </div>

          <div style="margin: 20px 0">
            <button class="btn-teacher" onclick="showCreateStudentModal()">
              â• Crear Nuevo Estudiante
            </button>
            <!-- Exportar Lista y Acciones en Lote eliminados por peticiÃ³n -->
          </div>

          <div id="students-list">
            <!-- Se carga dinÃ¡micamente -->
          </div>
        </div>

        <!-- Contenido de Monitoreo de Proyectos -->
        <div id="project-monitoring" class="tab-content">
          <h3>ğŸ“Š Monitoreo de Proyectos de Estudiantes</h3>
          <div id="projects-monitoring-content">
            <!-- Se carga dinÃ¡micamente -->
          </div>
        </div>

        <!-- Contenido de AnÃ¡lisis de Reportes -->
        <div id="reports-analysis" class="tab-content">
          <h3>ğŸ“ˆ AnÃ¡lisis de Reportes</h3>
          <div id="reports-analysis-content">
            <!-- Se carga dinÃ¡micamente -->
          </div>
        </div>
      </div>

      <!-- Modal para crear estudiante -->
      <div
        id="create-student-modal"
        style="
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.5);
          z-index: 1000;
          justify-content: center;
          align-items: center;
        "
      >
        <div
          style="
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
          "
        >
          <h4>ğŸ‘¨â€ğŸ“ Crear Nuevo Estudiante</h4>
          <form id="create-student-form" onsubmit="createStudent(event)">
            <div class="form-group">
              <label>ğŸ“§ Email:</label>
              <input type="email" name="email" required />
            </div>
            <div class="form-group">
              <label>ğŸ‘¤ Nombre de Usuario:</label>
              <input type="text" name="username" required />
            </div>
            <div class="form-group">
              <label>ğŸ”‘ ContraseÃ±a:</label>
              <input type="password" name="password" required minlength="6" />
            </div>
            <div class="form-group">
              <label>ğŸ”‘ Confirmar ContraseÃ±a:</label>
              <input
                type="password"
                name="confirm_password"
                required
                minlength="6"
              />
            </div>
            <div class="form-group">
              <label>ğŸ‘¨â€ğŸ’¼ Nombre Completo:</label>
              <input type="text" name="full_name" required />
            </div>
            <div class="form-group">
              <label>ğŸ« Grupo/Clase:</label>
              <input
                type="text"
                name="group_class"
                placeholder="Ej: Grupo A, ProgramaciÃ³n Web"
              />
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px">
              <button type="submit" class="btn-teacher">
                âœ… Crear Estudiante
              </button>
              <button
                type="button"
                class="btn-teacher danger"
                onclick="hideCreateStudentModal()"
              >
                âŒ Cancelar
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script src="js/api-service.js"></script>
    <script src="js/autenticacion.js"></script>
    <script>
      // ConfiguraciÃ³n especÃ­fica para docentes
      let teacherUserInfo = null;
      let allStudents = [];
      let sessionStart = Date.now(); // Para trackear tiempo de sesiÃ³n

      // Verificar permisos de docente al cargar
      window.onload = async () => {
        try {
          teacherUserInfo = await apiService.getCurrentUser();

          if (
            teacherUserInfo.role !== "docente" &&
            teacherUserInfo.role !== "administrador"
          ) {
            alert("âŒ Acceso denegado. Necesitas permisos de docente.");
            window.location.href = "panel.html";
            return;
          }

          // Cargar dashboard docente
          await loadTeacherDashboard();
          await loadStudentManagement();
        } catch (error) {
          console.error("Error cargando panel docente:", error);
          if (error.message === "SesiÃ³n expirada") return;
          alert("Error al cargar panel docente: " + error.message);
        }
      };

      // ===== GESTIÃ“N DE PESTAÃ‘AS =====
      function showTeacherTab(tabName) {
        // Ocultar todas las pestaÃ±as
        document.querySelectorAll(".tab-content").forEach((tab) => {
          tab.classList.remove("active");
        });
        document.querySelectorAll(".tab").forEach((tab) => {
          tab.classList.remove("active");
        });

        // Mostrar pestaÃ±a seleccionada
        document.getElementById(tabName).classList.add("active");
        event.target.classList.add("active");

        // Cargar contenido especÃ­fico
        switch (tabName) {
          case "student-management":
            loadStudentManagement();
            break;
          case "project-monitoring":
            loadProjectMonitoring();
            break;
          case "reports-analysis":
            loadReportsAnalysis();
            break;
          case "class-statistics":
            loadClassStatistics();
            break;
        }
      }

      // ===== DASHBOARD DOCENTE =====
      async function loadTeacherDashboard() {
        try {
          const container = document.getElementById(
            "teacher-dashboard-content"
          );

          container.innerHTML = `
                  <div class="dashboard-grid">
                      <div class="dashboard-card">
                          <h3>ğŸ‘‹ Bienvenido</h3>
                          <div class="number">ğŸ‘¨â€ğŸ«</div>
                          <p>${
                            teacherUserInfo.full_name ||
                            teacherUserInfo.username
                          }</p>
                      </div>
                      <div class="dashboard-card">
                          <h3>ğŸ“… Fecha</h3>
                          <div class="number" style="font-size: 1.5em;">${new Date().toLocaleDateString()}</div>
                          <p>Fecha actual</p>
                      </div>
                      <div class="dashboard-card">
                          <h3>â° Hora</h3>
                          <div class="number" style="font-size: 1.5em;" id="current-time">--:--</div>
                          <p>Hora actual</p>
                      </div>
                      <div class="dashboard-card">
                          <h3>ğŸ¯ Estado</h3>
                          <div class="number">âœ…</div>
                          <p>Sistema activo</p>
                      </div>
                  </div>
              `;

          // Actualizar hora cada segundo
          setInterval(() => {
            document.getElementById("current-time").textContent =
              new Date().toLocaleTimeString("es-ES", {
                hour: "2-digit",
                minute: "2-digit",
              });
          }, 1000);
        } catch (error) {
          console.error("Error cargando dashboard docente:", error);
        }
      }

      // ===== GESTIÃ“N DE ESTUDIANTES =====
      async function loadStudentManagement() {
        try {
          // Los docentes ya NO pueden ver listas de usuarios
          // Solo pueden crear estudiantes

          // Mostrar mensaje informativo
          document.getElementById("total-students").textContent =
            "No disponible";
          document.getElementById("active-students").textContent =
            "No disponible";
          document.getElementById("total-projects").textContent =
            "No disponible";
          document.getElementById("total-analysis").textContent =
            "No disponible";

          // Cargar interfaz simplificada para docentes
          loadSimplifiedStudentInterface();
        } catch (error) {
          console.error("Error cargando gestiÃ³n de estudiantes:", error);
        }
      }

      function loadSimplifiedStudentInterface() {
        const container = document.getElementById("students-list");

        container.innerHTML = `
              <div class="alert-item" style="background: #e9f4ff; padding: 20px; border-radius: 8px; margin: 20px 0;">
                  <h4>â„¹ï¸ InformaciÃ³n para Docentes</h4>
                  <p>Como docente, puedes <strong>crear nuevos estudiantes</strong> pero no tienes acceso a la visualizaciÃ³n de listas completas de usuarios.</p>
                  <p>Esta restricciÃ³n garantiza la privacidad y seguridad del sistema.</p>
              </div>
              
              <div style="text-align: center; padding: 40px; background: #f8f9fa; border-radius: 10px;">
                  <h3>ğŸ‘¨â€ğŸ“ Crear Nuevo Estudiante</h3>
                  <p style="margin: 15px 0; color: #666;">Usa el botÃ³n de abajo para crear un nuevo estudiante en el sistema</p>
                  <button class="btn-teacher" onclick="showCreateStudentModal()" style="font-size: 16px; padding: 12px 24px;">
                      â• Crear Nuevo Estudiante
                  </button>
              </div>
              
              <div class="alert-item" style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 20px 0;">
                  <h5>ğŸ›¡ï¸ Permisos de Docente:</h5>
                  <ul style="margin: 10px 0 0 20px;">
                      <li>âœ… Crear estudiantes</li>
                      <li>âœ… Monitorear proyectos (funcionalidad disponible)</li>
                      <li>âœ… Ver anÃ¡lisis y reportes (funcionalidad disponible)</li>
                      <li>âŒ Gestionar otros docentes</li>
                      <li>âŒ Cambiar roles de usuario</li>
                  </ul>
              </div>
              
              <div id="creation-history" style="margin-top: 30px;">
                  <h4>ğŸ“ Historial de CreaciÃ³n</h4>
                  <div id="creation-log" style="background: #f8f9fa; padding: 15px; border-radius: 8px; min-height: 60px;">
                      <p style="color: #666; font-style: italic;">No hay estudiantes creados en esta sesiÃ³n.</p>
                  </div>
              </div>
          `;

        // Al cargar la interfaz, traer del backend los estudiantes creados por este docente
        fetchCreationHistory();
      }

      // Traer historial persistente desde el backend
      async function fetchCreationHistory() {
        try {
          const data = await apiService.getStudentsByCreator();
          // data viene como lista de objetos {id, correo, nombre_completo, fecha_creacion}
          createdStudents = data.map((s) => ({
            email: s.correo,
            username: s.correo.split('@')[0],
            full_name: s.nombre_completo,
            created_at: s.fecha_creacion ? new Date(s.fecha_creacion).toLocaleString('es-ES') : ''
          }));
          updateCreationHistory();
        } catch (error) {
          console.error('No se pudo cargar el historial de creaciÃ³n:', error);
          // Si viene 401, el controlador de api-service ya redirige, aquÃ­ solo silenciosamente no mostramos nada
        }
      }

      // ===== CREAR ESTUDIANTE =====
      let createdStudents = []; // Historial local de estudiantes creados

      function showCreateStudentModal() {
        document.getElementById("create-student-modal").style.display = "flex";
      }

      function hideCreateStudentModal() {
        document.getElementById("create-student-modal").style.display = "none";
        document.getElementById("create-student-form").reset();
      }

      async function createStudent(event) {
        event.preventDefault();
        const formData = new FormData(event.target);

        // Validar contraseÃ±as
        const password = formData.get("password");
        const confirmPassword = formData.get("confirm_password");

        if (password !== confirmPassword) {
          alert("âŒ Las contraseÃ±as no coinciden");
          return;
        }

        const studentData = {
          email: formData.get("email"),
          username: formData.get("username"),
          password: password,
          role: "estudiante",
          full_name: formData.get("full_name"),
        };

        try {
          await apiService.createUser(studentData);

          // Agregar al historial local
          createdStudents.push({
            email: studentData.email,
            username: studentData.username,
            full_name: studentData.full_name,
            created_at: new Date().toLocaleString("es-ES"),
          });

          alert(`âœ… Estudiante ${studentData.username} creado exitosamente`);
          hideCreateStudentModal();
          updateCreationHistory(); // Actualizar historial
        } catch (error) {
          alert("âŒ Error: " + error.message);
        }
      }

      function updateCreationHistory() {
        const container = document.getElementById("creation-log");

        if (createdStudents.length === 0) {
          container.innerHTML =
            '<p style="color: #666; font-style: italic;">No hay estudiantes creados en esta sesiÃ³n.</p>';
          // Actualizar tambiÃ©n los recuadros del dashboard para reflejar 0
          updateStudentDashboardStats();
          return;
        }

        container.innerHTML = `
          <div style="max-height: 200px; overflow-y: auto;">
            ${createdStudents
              .map(
                (student, index) => `
              <div style="background: white; padding: 10px; margin: 5px 0; border-radius: 4px; border-left: 3px solid #28a745;">
                <strong>${student.full_name || student.username}</strong><br>
                <small>ğŸ“§ ${student.email} | â° ${student.created_at}</small>
              </div>
            `
              )
              .join("")}
          </div>
          <div style="margin-top: 10px; text-align: center;">
            <small style="color: #666;">Total creados en esta sesiÃ³n: ${
              createdStudents.length
            }</small>
          </div>
        `;
        // Actualizar recuadros del dashboard tras renderizar el historial
        updateStudentDashboardStats();
      }

      // Actualiza los recuadros de estadÃ­sticas del docente basÃ¡ndose en el historial local
      function updateStudentDashboardStats() {
        try {
          const total = createdStudents.length || 0;
          // Para ahora tratamos 'activos' igual a total (puede mejorarse con llamada a backend)
          const active = total;
          document.getElementById("total-students").textContent = total;
          document.getElementById("active-students").textContent = active;
          // Proyectos y anÃ¡lisis no estÃ¡n disponibles por ahora; mostramos 0 o un placeholder
          document.getElementById("total-projects").textContent = "0";
          document.getElementById("total-analysis").textContent = "0";
        } catch (e) {
          // Si los elementos no existen o hay algÃºn error, lo ignoramos silenciosamente
          console.debug('No se pudieron actualizar las estadÃ­sticas del dashboard:', e);
        }
      }

      // ===== ACCIONES DE ESTUDIANTE (SIMPLIFICADAS) =====
      function viewStudentProjects(studentEmail) {
        alert(
          `ğŸ“‚ Ver proyectos de ${studentEmail} - Funcionalidad disponible prÃ³ximamente`
        );
      }

      function viewStudentReports(studentEmail) {
        alert(
          `ğŸ“Š Ver reportes de ${studentEmail} - Funcionalidad disponible prÃ³ximamente`
        );
      }

      // ===== OTRAS PESTAÃ‘AS (SIMULADAS) =====
      function loadProjectMonitoring() {
        const container = document.getElementById(
          "projects-monitoring-content"
        );
        container.innerHTML = `
              <div class="alert-item">
                  <p>Esta secciÃ³n permite monitorear todos los proyectos subidos por los estudiantes en tiempo real.</p>
                  <ul>
                      <li>ğŸ“ˆ Estado de anÃ¡lisis en progreso</li>
                      <li>ğŸ“Š Resultados de vulnerabilidades detectadas</li>
                      <li>â±ï¸ Tiempo de procesamiento</li>
                      <li>ğŸ“‹ Historial de anÃ¡lisis</li>
                  </ul>
                  <button class="btn-teacher">ğŸ”„ Actualizar Estado</button>
              </div>
          `;
      }

      function loadReportsAnalysis() {
        const container = document.getElementById("reports-analysis-content");
        container.innerHTML = `
              <div class="alert-item">
                  <p>AnÃ¡lisis consolidado de todos los reportes de estudiantes.</p>
                  <ul>
                      <li>ğŸ“Š EstadÃ­sticas de vulnerabilidades mÃ¡s comunes</li>
                      <li>ğŸ“ˆ Tendencias de mejora por estudiante</li>
                      <li>ğŸ¯ Ãreas que requieren mayor atenciÃ³n</li>
                      <li>ğŸ“‹ Comparativas entre proyectos</li>
                  </ul>
                  <button class="btn-teacher">ğŸ“Š Generar Reporte</button>
              </div>
          `;
      }

      // ===== FUNCIONES ADICIONALES =====
      // Exportar y acciones en lote eliminadas del panel docente
    </script>
    <script src="js/dark-mode.js"></script>
  </body>
</html>
